{"version":3,"sources":["tester/data-sources/alphavantage/api.ts"],"names":["debug","Debug","API_KEY","process","searchSymbol","keywords","a","axios","get","resp","data","bestMatches","map","symbol","obj","name","type","currency","normalizeCandles","candles","timeZone","parsed","Object","entries","key2","value2","console","log","date","open","high","low","close","volume","tmp1","moment","tz","utcOffset","tmp2","subtract","add","toDate","unshift","getCandles","period","url","key1","value1","includes"],"mappings":"qUASMA,EAAQC,IAAM,SAEdC,EAAUC,mBAaZC,EAAY,uCAAG,WAAgBC,GAAhB,eAAAC,EAAA,sEACEC,IAAMC,IAAI,qEAAuEH,EAAW,WAAaH,GAD3G,cACXO,EADW,OAEjBT,EAAM,eAAgBS,EAAKC,MAFV,kBAGOD,EAAKC,KAAKC,YAbnBC,KAAI,SAAAC,GACjB,IAAIC,EAAuB,CAAED,OAAQ,GAAIE,KAAM,GAAIC,KAAM,GAAIC,SAAU,IAKvE,OAJAH,EAAID,OAASA,EAAO,aACpBC,EAAIC,KAAOF,EAAO,WAClBC,EAAIE,KAAOH,EAAO,WAClBC,EAAIG,SAAWJ,EAAO,eACfC,MAIQ,2CAAH,sDAMZI,EAAmB,SAAUC,EAAiCC,GAGhE,IAFA,IAAMC,EAAS,GAEf,MAA2BC,OAAOC,QAAQJ,GAA1C,eAAoD,CAAC,IAAD,0BAA1CK,EAA0C,KAApCC,EAAoC,KAClDC,QAAQC,IAAI,iCAAkCH,GAC9C,IAAIV,EAAuB,CAAEc,KAAM,EAAGC,KAAM,EAAGC,KAAM,EAAGC,IAAK,EAAGC,MAAO,EAAGC,OAAQ,GAE9EC,EAAOC,IAAOX,GAAMY,GAAGhB,GAAUiB,YACjCC,EAAOH,IAAOX,GAAMY,GAAG,oBAAoBC,YAC/CvB,EAAIc,KAAOO,IAAOX,GAAMe,SAASL,EAAM,WAAWM,IAAIF,EAAM,WAAWG,SACvE3B,EAAIe,KAAOJ,EAAO,WAClBX,EAAIgB,KAAOL,EAAO,WAClBX,EAAIiB,IAAMN,EAAO,UACjBX,EAAIkB,MAAQP,EAAO,YACnBX,EAAImB,OAASR,EAAO,aAEpBJ,EAAOqB,QAAQ5B,GAEjB,OAAOO,GAGLsB,EAAU,uCAAG,WAAgB9B,EAAgB+B,GAAhC,+BAAAtC,EAAA,6DAOfN,EAAM,wBAJJ6C,EADED,EAAS,GACL,0EAA4E/B,EAAS,aAAe+B,EAAS,cAAgB1C,EAE7H,uEAAyEW,EAAS,WAAaX,GALxF,SAQIK,IAAMC,IAAIqC,GARd,OAQTpC,EARS,OASfT,EAAM,wBAAyBS,EAAKC,MAC9BU,EAAWX,EAAKC,KAAK,aAAa,gBACxCgB,QAAQC,IAAI,iBAAkBP,GAXf,MAYYE,OAAOC,QAAQd,EAAKC,MAZhC,sEAYLoC,EAZK,KAYCC,EAZD,MAaTD,EAAKE,SAAS,eAbL,0CAcJ9B,EAAiB6B,EAAkC3B,IAd/C,uEAAH","file":"static/js/11.81312911.chunk.js","sourcesContent":["// GENERAL DEPENDENCIES\r\nimport axios from 'axios'\r\n\r\nimport * as i from '../../interfaces'\r\n\r\n// DEBUGGING\r\nimport Debug from 'debug'\r\n//import moment from 'moment';\r\nimport moment from 'moment-timezone';\r\nconst debug = Debug('avapi')\r\n\r\nconst API_KEY = process.env.REACT_APP_ALPHAVANTAGE_API_KEY;\r\n\r\nlet normalizeSymbols = function (symbols: Array<i.IAVBestMatch>) {\r\n  return symbols.map(symbol => {\r\n    let obj: i.ICommonSymbol = { symbol: '', name: '', type: '', currency: '' };\r\n    obj.symbol = symbol['1. symbol'];\r\n    obj.name = symbol['2. name'];\r\n    obj.type = symbol['3. type'];\r\n    obj.currency = symbol['8. currency'];\r\n    return obj;\r\n  });\r\n}\r\n\r\nlet searchSymbol = async function (keywords: string) {\r\n  const resp = await axios.get('https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=' + keywords + '&apikey=' + API_KEY);\r\n  debug('searchSymbol', resp.data);\r\n  return normalizeSymbols(resp.data.bestMatches);\r\n}\r\n\r\nlet normalizeCandles = function (candles: Array<i.IAVTimeSeries>, timeZone: string) {\r\n  const parsed = [];\r\n\r\n  for (let [key2, value2] of Object.entries(candles)) {\r\n    console.log('alphavantage candle timestamp:', key2); // \"2020-03-31 14:15:00\". Ok with doc!\r\n    let obj: i.ICommonCandle = { date: 0, open: 0, high: 0, low: 0, close: 0, volume: 0 };\r\n\r\n    let tmp1 = moment(key2).tz(timeZone).utcOffset();\r\n    let tmp2 = moment(key2).tz(\"Europe/Bucharest\").utcOffset();\r\n    obj.date = moment(key2).subtract(tmp1, 'minutes').add(tmp2, 'minutes').toDate(); // voodoo\r\n    obj.open = value2['1. open'];\r\n    obj.high = value2['2. high'];\r\n    obj.low = value2['3. low'];\r\n    obj.close = value2['4. close'];\r\n    obj.volume = value2['5. volume'];\r\n\r\n    parsed.unshift(obj);\r\n  }\r\n  return parsed;\r\n}\r\n\r\nlet getCandles = async function (symbol: string, period: number) {\r\n  let url;\r\n  if (period < 61) {\r\n    url = 'https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=' + symbol + '&interval=' + period + 'min&apikey=' + API_KEY;\r\n  } else {\r\n    url = 'https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=' + symbol + '&apikey=' + API_KEY;\r\n  }\r\n  debug('getTimeSeriesIntraday', url);\r\n  const resp = await axios.get(url);\r\n  debug('getTimeSeriesIntraday', resp.data);\r\n  const timeZone = resp.data['Meta Data']['6. Time Zone'];\r\n  console.log('Using timezone', timeZone);\r\n  for (let [key1, value1] of Object.entries(resp.data)) {\r\n    if (key1.includes('Time Series')) {\r\n      return normalizeCandles(value1 as Array<i.IAVTimeSeries>, timeZone);\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  searchSymbol,\r\n  getCandles\r\n}"],"sourceRoot":""}